<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo_text.svg" width="320" alt="Nest Logo" /></a>
</p>

[circleci-image]: https://img.shields.io/circleci/build/github/nestjs/nest/master?token=abc123def456
[circleci-url]: https://circleci.com/gh/nestjs/nest

  <p align="center">A progressive <a href="http://nodejs.org" target="_blank">Node.js</a> framework for building efficient and scalable server-side applications.</p>
    <p align="center">
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/v/@nestjs/core.svg" alt="NPM Version" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/l/@nestjs/core.svg" alt="Package License" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/dm/@nestjs/common.svg" alt="NPM Downloads" /></a>
<a href="https://circleci.com/gh/nestjs/nest" target="_blank"><img src="https://img.shields.io/circleci/build/github/nestjs/nest/master" alt="CircleCI" /></a>
<a href="https://coveralls.io/github/nestjs/nest?branch=master" target="_blank"><img src="https://coveralls.io/repos/github/nestjs/nest/badge.svg?branch=master#9" alt="Coverage" /></a>
<a href="https://discord.gg/G7Qnnhy" target="_blank"><img src="https://img.shields.io/badge/discord-online-brightgreen.svg" alt="Discord"/></a>
<a href="https://opencollective.com/nest#backer" target="_blank"><img src="https://opencollective.com/nest/backers/badge.svg" alt="Backers on Open Collective" /></a>
<a href="https://opencollective.com/nest#sponsor" target="_blank"><img src="https://opencollective.com/nest/sponsors/badge.svg" alt="Sponsors on Open Collective" /></a>
  <a href="https://paypal.me/kamilmysliwiec" target="_blank"><img src="https://img.shields.io/badge/Donate-PayPal-ff3f59.svg"/></a>
    <a href="https://opencollective.com/nest#sponsor"  target="_blank"><img src="https://img.shields.io/badge/Support%20us-Open%20Collective-41B883.svg" alt="Support us"></a>
  <a href="https://twitter.com/nestframework" target="_blank"><img src="https://img.shields.io/twitter/follow/nestframework.svg?style=social&label=Follow"></a>
</p>
  <!--[![Backers on Open Collective](https://opencollective.com/nest/backers/badge.svg)](https://opencollective.com/nest#backer)
  [![Sponsors on Open Collective](https://opencollective.com/nest/sponsors/badge.svg)](https://opencollective.com/nest#sponsor)-->

## Description

Basic CRUD operation program to write posts.

## Features
#### Architecture
I followed the architecture provided by Nestjs out-of-the-box. I have two main modules: Users and Posts.
For each module there is a controller, service, and repository (the repository is automatically generated by TypeOrm).
To give a brief overview of how this architecture works, all the HTTP requests first go to the controller then the relevant business logic that is stored in the service is executed. All access to the database is in the repository. See the diagram below for extra reference.

<img width="546" alt="image" src="https://user-images.githubusercontent.com/77760709/139032226-d81328f8-083f-407a-a99b-c9db2c1dd941.png">

### Posts CRUD
I created CRUD operations for the Posts module using the architecture mentioned above but I did not do so for the Users module. I created signin, signout, and signup functionalities for the Users module (I understand that signin, signout, etc. methods are usually in a separate authentication module but did not find it necessary for this project).

### Authentication
#### Cookie-session
I used a cookie session to implement authentication. This means that when a user signs in the program passes in a user id into the session which then allows the user to write, update, etc. relevant posts. 

The password was hashed before storing in the database to prevent anyone from accessing it. 

Instead of simply hashing the password I combined it with a salt(random string) because even though the password is hashed malevolent hackers may be able to guess the password by brute forcing different passwords (rainbow attack). By hashing the password with a salt it makes it significantly more difficult to find the password.

In order to read, create, update, or delete any post, you have to be signed in. I implemented this using a Nestjs Guard which returns a session userId if the user is signed in.

### Authorization
If authentication deals with whether a user is signed in or not, authorization deals with whether a user is authorized to execute some action. For example, there are actions only "admin" level users can do. In this project only the user that is the author of a post can update or delete it. This, I also implemented using a Nestjs Guard called "isAuthorGuard" that returns a boolean depending on whether the post's author id is the same as the currently signed in user's id. If false, the user is not authorized to udpate or delete the post.


## Tech
> - Back-End :  ![NestJS](https://img.shields.io/badge/nestjs-%23E0234E.svg?style=for-the-badge&logo=nestjs&logoColor=white) ![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white) ![SQLite](https://img.shields.io/badge/sqlite-%2307405e.svg?style=for-the-badge&logo=sqlite&logoColor=white)
> - ETC :  <img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white"/>&nbsp;<img src="https://img.shields.io/badge/Github-181717?style=for-the-badge&logo=Github&logoColor=white"/>&nbsp;![Swagger](https://img.shields.io/badge/-Swagger-%23Clojure?style=for-the-badge&logo=swagger&logoColor=white)

## API Documentation

To make it easier to test the APIs I implemented Swagger.
After installing this project, access http://localhost:3000/api/ to go the site seen in the picture below. Directions for installation is provided below.

![image](https://user-images.githubusercontent.com/77760709/141698285-389f9e06-0c0a-4a4a-af37-485a28d03d58.png)


### Base URL: localhost:3000
### Users
#### Signin
```POST users/signin```

Request
```
{
  "email": "test1@test.com", 
  "password":"test"
} 
```
Response

*Success*
```
{
  "id": 1,
  "email": "test1@test.com",
}
```
*Error*
```
{
  "statusCode": 404,
  "message": "user not found",
  "error": "Not Found"
}
```
#### Signout
```POST users/signout```
#### Signup
```POST users/signup```

Request
```
{
  "email": "test1@test.com", 
  "password":"test1"
} 
```
Response

*Success*
```
{
  "email": "test@test.com",
  "id": 1
}
```
*Error*
```
{
  "statusCode": 400,
  "message": "Email in use",
  "error": "Bad Request"
}
```
#### whoami 
Check to see who is currently signed in
```GET users/whoami```

### Posts
#### Create Post
```POST posts```

Request
{
    "post": "test1"
}

Response

*Success*
```
{
  "post": "test3",
  "date": "2021-10-26T22:56:19.257Z",
  "user": {
    "id": 1,
    "email": "test1@test.com",
  },
  "author": 1,
  "id": 4
}
```
*Error*
```
{
  "statusCode": 403,
  "message": "Forbidden resource",
  "error": "Forbidden"
}
```
#### Find Post
```GET posts/{id}```

Response

*Success*
```
{
  "id": postId,
  "post": "postContent",
  "date": "DatePosted",
  "author": authorId
}
```

*Error*
```
{
  "statusCode": 404,
  "message": "Post not found",
  "error": "Not Found"
}
```
#### Find All Posts
```GET posts?limit={number}&offset={number}```
Response

*Success*
```
{
  "posts": [
    {PostEntity},
    {PostEntity}
  ],
  "count": "countNumber"
}
```
*Error*
```
{
  "statusCode": 403,
  "message": "Forbidden resource",
  "error": "Forbidden"
}
```
#### Update Post
```PATCH posts/{id}```

Request
```
{
    "post": "updateTest1"
}
```

Response

*Success*
```
{
  "id": postId,
  "post": "updatedPostContent",
  "date": "datePostFirstCreated",
  "author": authorId
}
```
*Error*
```
{
  "statusCode": 403,
  "message": "Forbidden resource",
  "error": "Forbidden"
}
```
#### Delete Post
```DELETE posts/{id}```
*Error*
```
{
  "statusCode": 403,
  "message": "Forbidden resource",
  "error": "Forbidden"
}
```
## Installation

```bash
$ npm install
```

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```


